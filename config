// External modules
var express = require('express'),
    path = require('path'),

// Internal modules
    config = require('./config'),

// Modular variables
    app = express();

// Express configuration

// Server setup, files, and routing are exported from here
module.exports = function() {
  var options = {root: __dirname + '/../../client/', dotfiles: 'deny'};
  app.use(express.static(path.join(__dirname, '../../client')));
  
  // Routing Logic
  // Root route - "index.html"
  app.get('/', function(req, res){ 
    res.sendFile('index.html', options, function(err){
      if (err) throw err;
    });
  });
  // Page not found route - "404"
  app.get('/page-not-found', function(req, res){
    res.sendFile('page-not-found.html', options, function(err){
      if (err) throw err;
    });
  });
  // Unauthorized route - "401"
  app.get('/unauthorized', function(req, res){
    res.sendFile('unauthorized.html', options, function(err){
      if (err) throw err;
    });
  });

  // start the server
  app.listen(config.port);
  console.log('Listening on port ' + config.port);

  return app;
};
